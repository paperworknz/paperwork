<!DOCTYPE html>
<html lang="en">
	<head>
		{% include path.html.head_public %}
		{% include path.html.pixel %}
	</head>
	<body>
		<header>
			<div class="wrap width">
				<div class="nav">
					<div class="major_title logo" style="cursor:pointer" onclick="window.location= '{{environment.root}}'">Paperwork</div>
					<ul class="nav_list_less wrap">
						<li>
							<span class="color_hint" home>Home</span>
						</li>
						<li class="disable no-click">
							<span login>Log In</span>
						</li>
						<li>
							<span class="special" register>Sign Up</span>
						</li>
					</ul>
				</div>
			</div>
		</header>
		<section>
			<div class="width">
				<div class="main top centered">
					<div style="display:inline-block;width:30%;min-width:280px">
						<div class="login user-information">
							<div class="container">
								<input type="text" name="username" placeholder="Email / Username">
							</div>
							<div class="container">
								<input type="password" name="password" placeholder="Password">
							</div>
							{% if environment.maintenance %}
							<div class="alert alert-info" style="margin-bottom:10px;">
								We're currently offline for maintenance and will be back up as soon as we can. Sorry about this!
							</div>
							{% endif %}
							<div class="container">
								<button class="button next-step {% if maintenance %}no-click button-wait{% endif %}">LOG IN</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
		<footer>
			<div class="centered">
				<a href="https://www.facebook.com/paperworkapp" target="_blank">
					<img class="fb" title="Our Facebook Page" src="{{environment.root}}/css/media/icon/facebook/png/FB-f-Logo__blue_29.png" />
				</a>
				<div style="padding:15px 0px;"><a href="{{environment.root}}/privacy-policy">Privacy Policy</a></div>
			</div>
		</footer>
		<script>
		var environment = {
			root: '{{environment.root}}',
			page: '{{path.page}}',
		};
		</script>
		{% include path.html.js %}
		<script>
			$(function(){
				// Nav
				$('[home]').on('click', function(){
					window.location = '{{environment.root}}';
				});
				$('[login]').on('click', function(){
					window.location = '{{environment.root}}/login';
				});
				$('[register]').on('click', function(){
					window.location = '{{environment.root}}/register';
				});
				
				var login = function(){
					$('.next-step').focus();
					
					$.post('{{environment.root}}/post/login', {
						username: $('input[name=username]').val(),
						password: $('input[name=password]').val(),
					}).done(function(data){
						data = JSON.parse(data);
						
						// Put alert on screen if it doesn't exist
						if(data.message){
							if($('.alert').length < 1){
								$('.next-step').before('<div class="alert">'+data.message+'</div>');
							}else{
								$('.alert').removeClass('alert-success');
								$('.alert').removeClass('alert-danger');
								$('.alert').html(data.message);
							}
							
							if(data.type == 'success'){
								$('.alert').addClass('alert-success');
							}else{
								$('.alert').addClass('alert-danger');
							}
						}
						
						if(data.type == 'success'){
							window.location = data.location;
						}else{
							Paperwork.ready($('.next-step'), 'LOG IN');
						}
					});
				};
				
				// Login on click (inputFlow triggers this)
				$('.next-step').on('click', function(){
					login();
				});
			});
		</script>
	</body>
</html>