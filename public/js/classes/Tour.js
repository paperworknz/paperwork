"use strict";var Tour=function(t,e){function n(t){var e={};t=JSON.parse(t);for(var n in t){var o=t[n];switch(-1!==n.indexOf("e.")&&Events.post(n.replace("e.",""),o),n){case"href":o.trim()&&(e.href=o);break;case"chain":o!==!0&&"true"!==o&&"1"!=o&&(e.chain=!1);break;case"return":"anchor"==o.toLowerCase()&&(e["return"]="anchor"),"item"==o.toLowerCase()&&(e["return"]="item")}}return e}function o(e,n,o){var i,r,a,c,d,f,u,p,l,m=0,h=o.object,v=o.object.find(".dark_object");e.position&&(l=e.position.split("-")[0]);var w=function g(l){function w(i,r,a,c,d){var f=t(window).width(),u=t(window).height();if(4!==d){if(0>i)return m++,g("right");if(r+a>f)return m++,g("bottom");if(i+c>u)return m++,g("left");if(0>r)return m++,g("top")}else console.warn("Tour skipped: Screen size too small."),s(e,n,o,!1)}switch(h.find(".pw-item-container").remove(),v.after('\n			<div class="pw-item-container wrap">\n			</div>\n		'),l){case"left":case"right":h.find(".pw-item-container").append('\n					<div class="pw-item-text '+l+'">\n						'+e.text+'\n					</div>\n					<div class="triangle-parent '+l+'">\n						<div class="triangle '+l+'">\n						</div>\n					</div>\n				');break;case"top":h.find(".pw-item-container").append('\n					<div class="pw-item-text">\n						'+e.text+'\n					</div>\n					<div class="triangle-parent '+l+'">\n						<div class="triangle '+l+'">\n						</div>\n					</div>\n				');break;case"bottom":h.find(".pw-item-container").append('\n					<div class="triangle-parent '+l+'">\n						<div class="triangle '+l+'">\n						</div>\n					</div>\n					<div class="pw-item-text">\n						'+e.text+"\n					</div>\n				")}switch(i=h.find(".pw-item-container"),r=h.find(".triangle"),a=h.find(".pw-item-text"),p=5,l){case"left":case"right":r.parent().css("height",a.outerHeight()),r.css("top",r.parent().outerHeight()/2-r.outerHeight()/2);break;case"top":case"bottom":r.parent().css("width",a.outerWidth())}switch(c=n.offset().top,d=n.offset().left,f=i.outerWidth(),u=i.outerHeight(),l){case"top":i.css({top:c-u-p,left:d+(n.outerWidth()/2-f/2)}),w(i.offset().top,i.offset().left,f,u,m);break;case"right":i.css({top:c+n.outerHeight()/2-u/2,left:d+n.outerWidth()+5}),w(i.offset().top,i.offset().left,f,u,m);break;case"bottom":i.css({top:c+n.outerHeight()+p,left:d+(n.outerWidth()/2-f/2)}),w(i.offset().top,i.offset().left,f,u,m);break;case"left":i.css({top:c+n.outerHeight()/2-u/2,left:d-f-5}),w(i.offset().top,i.offset().left,f,u,m)}};return w(l),i}function i(e){var i,r=t(e.anchor),a=Paperwork.dark();return e.adjustments={},e.commands&&(e.commands=n(e.commands)),r.length?(r.css("box-shadow")&&(e.adjustments["box-shadow"]=r.css("box-shadow")),r.css("z-index")&&(e.adjustments["z-index"]=r.css("z-index")),"static"==r.css("position")&&(e.adjustments.position="static",r.css("position","relative")),"auto"!=r.css("background-color")&&"rgba(0, 0, 0, 0)"!=r.css("background-color")||(e.adjustments["background-color"]="",r.css("background-color","white")),r.css("z-index","1000"),r.css("box-shadow","0 1px 2px rgba(0,0,0,.1)"),i=o(e,r,a),e.commands["return"]?"anchor"==e.commands["return"]?(i.find(".pw-item-text").css("cursor","default"),r.on("click",function(){s(e,r,a)})):"item"==e.commands["return"]&&i.on("click",function(){s(e,r,a)}):(r.on("click",function(){s(e,r,a)}),i.on("click",function(){s(e,r,a)})),void a.run()):(console.warn("Tour skipped: Anchor unavailable."),void s(e,r,a,!1))}function s(n,o,s,r){s.remove(function(){for(var s in n.adjustments){var d=n.adjustments[s];o.css(s,d)}void 0==r&&(r=!0),r&&t.post(e.root+"/delete/tour",{id:n.id}).done(function(){if(n.commands.href)t("body").css("pointer-events","none"),Paperwork["goto"](n.commands.href);else if(0===a){if(void 0!=n.commands.chain&&!n.commands.chain)return;a++,c[a]&&i(c[a])}})})}function r(){t.post(e.root+"/get/tour",{page:e.page}).done(function(t){t&&(c=JSON.parse(t),c.length>1&&(a=0),i(c[0]))})}var a,c=[];return{run:r,render:i}}(jQuery,environment);