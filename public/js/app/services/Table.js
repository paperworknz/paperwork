"use strict";var Table=function(t,a){function e(t){var a=this.attributes["data-row"].value;w.find('[data-row="'+a+'"]').toggleClass("wt-row-hover")}function n(){if(localStorage.map)return void(u=JSON.parse(localStorage.map));var t=g.filter?g.filter:"All";u={filter:t,columns:{}},v.each(function(t){var a=this.attributes["data-id"].value,e=g.width[a]?g.width[a]:"";u.columns[a]={index:t,state:"def",stateOrder:t,width:e}}),r()}function r(){return localStorage?void(localStorage.map=JSON.stringify(u)):void console.warn("Unable to save map to localStorage")}function i(t,a){function e(t,a,e){var n=t.indexOf(a);if(-1===n)throw new Error("Element not found in array");return 0>e&&(e=0),"end"==e&&(e=t.length+1),t.splice(n,1),t.splice(e,0,a),t}var n=a.attr("data-state"),i=[];for(var s in u.columns){var d=u.columns[s];i[d.stateOrder]=s}switch(i="desc"!=n?e(i,t,0):e(i,t,"end"),n){case"asc":n="desc",u.columns[t].state=n;break;case"desc":n="def",u.columns[t].state=n;break;case"def":n="asc",u.columns[t].state=n}for(var c in u.columns){var l=(u.columns[c],i.indexOf(c));u.columns[c].stateOrder=l}r(),o()}function o(){var e=[],n=[];m.val(u.filter),"All"==u.filter?h.show():(h.hide(),v.filter('[data-id="Status"]').find(".wt-row").each(function(){var a=this;t(this).text()==u.filter&&!function(){var e=a.attributes["data-row"].value;h.each(function(){this.attributes["data-row"].value==e&&t(this).show()})}()})),n=function(t){for(var a in t){var e=t[a];n[e.index]=v.filter('[data-id="'+a+'"]')}return n}(u.columns);for(var r in n){var i=n[r];t(".wt-wrap").append(i)}e=function(t){for(var a in t){var n=t[a];e[n.stateOrder]=a}return e.reverse()}(u.columns);for(var o in e){var d=e[o],c=v.filter('[data-id="'+d+'"]');"asc"==u.columns[d].state?(c.find("img").css("display","block"),c.find("img").attr("src",a.root+"/css/app/media/up.png"),c.find(".wt-head").attr("data-state","asc"),s(d,"asc")):"desc"==u.columns[d].state?(c.find("img").css("display","block"),c.find("img").attr("src",a.root+"/css/app/media/down.png"),c.find(".wt-head").attr("data-state","desc"),s(d,"desc")):"def"==u.columns[d].state&&(c.find("img").css("display","none"),c.find(".wt-head").attr("data-state","def"),s(d,"def"))}for(var l in u.columns){var f=u.columns[l];v.filter("[data-id="+l+"]").css("width",f.width)}w.css("display","block")}function s(a,e){var n='.wt-column[data-id="'+a+'"]',r=(t(n).find(".wt-row"),[]);switch(e){case"def":tinysort(n+" .wt-row",{attr:"data-row"});break;case"asc":tinysort(n+" .wt-row",{order:"asc"});break;case"desc":tinysort(n+" .wt-row",{order:"desc"})}t('.wt-column[data-id="'+a+'"] .wt-row').each(function(){r.push(t(this).attr("data-row"))}),v.each(function(){var e=this,n=t(this);t(this).attr("data-id")!=a&&!function(){var a={};t(e).find(".wt-row").each(function(){a[t(this).attr("data-row")]=t(this)});for(var i=0,o=r.length;o>i;i++)a[r[i]]&&n.append(a[r[i]])}()})}function d(t){return m.find('[value="'+t+'"]').length?(u.filter=t,void r()):void console.warn("Filter unavailable")}function c(t){if(!t)return console.warn("No configuration supplied"),!1;if(n(),t.filter&&d(t.filter),t.width)for(var a in t.width){var e=t.width[a];g.width[a]&&(g.width[a]=e)}l()}function l(){n(),o()}function f(){localStorage&&delete localStorage.map,l()}var u,w=t(".wt-table"),h=w.find(".wt-row"),v=w.find(".wt-column"),m=w.find(".wt-filter"),p=w.find(".wt-reset"),g={filter:"All",width:{ID:"44px",Name:"260px",Client:"165px",Status:"111px"}};return h.on("mouseover",e),h.on("mouseout",e),p.on("click",f),h.on("click",function(){goto(t(this).attr("href"))}),w.find("[wt-head]").on("click",function(){var a=t(this).closest(".wt-column").attr("data-id"),e=t(this).closest(".wt-head");i(a,e)}),m.on("change",function(){var a=t(this).val();d(a),o()}),void 0!=interact&&interact(".wt-column").resizable({edges:{right:!0}}).on("resizemove",function(a){var e=a.target,n=t(e).attr("data-id"),i=a.rect.width+"px";e.style.width=i,u.columns[n].width=i,r()}).allowFrom(".wt-head"),void 0!=Sortable&&new Sortable(document.getElementById("sortable"),{handle:".wt-head",animation:150,ghostClass:"wt-column-ghost",onEnd:function(a){t(".wt-column").each(function(a){u.columns[t(this).attr("data-id")].index=a,r()})}}),{configure:c,run:l,reset:f}}(jQuery,environment);