"use strict";Core.addModule("template",function(t){function e(){for(var t in u){var e=u[t];l.find(".color-palette").append('<div class="color" data-color="'+e+'" style="background-color: '+e+'"></div>')}void 0!=localStorage.vote&&l.find('[data-type="vote"]').replaceWith('<div style="display: inline;">&#10003;</div>').addClass("no-click").css("opacity","0.5")}function a(){var t={select:l.find(".template-icon"),"delete":l.find(".template-delete"),create:l.find('[data-type="template-create"]'),update:l.find('[data-type="properties-update"]')};for(var e in t)t[e].off();l.find('[data-type="template-name"]').on("keyup",function(){var t=$(this).closest('[data-type="obj"]').data("id");p(),"+"!=t&&l.find('[data-type="tab-container"] [data-id="'+t+'"]').html($(this).val())}),l.find('[data-type="template-name"]').on("change",function(){var t=$(this).closest("[data-template-id]").data("template-id"),e=$(this).val().trim();$.post(m.putTemplate,{id:t,name:e}).done(function(t){p(),Paperwork.send("notification")})}),t.create.on("click",function(){var t=l.find('.new-template [data-type="new-template-name"]').val().trim();$.post(m.post,{name:t}).done(function(t){var e=JSON.parse(t);l.find('.new-template [data-type="new-template-name"]').val(""),n({id:e.id,name:e.name,body:e.body}),Paperwork.ready(l.find('[data-type="template-create"]'),"CREATE")})}),Paperwork.validate(l.find(".new-template"),t.create,Paperwork.random(6),{allowDuplicates:!0}),l.on("click",'[data-type="previous"]',function(){i("previous")}),l.on("click",'[data-type="next"]',function(){i("next")}),l.on("mouseover",'[data-type="row"]',function(){var t=$(this).find('[data-type="key"]').text().trim();-1==t.indexOf("colour")&&l.find('[data-property="'+t+'"]').css("background-color","#D6EDFF")}),l.on("mouseout",'[data-type="row"]',function(){var t=$(this).find('[data-type="key"]').text().trim();-1==t.indexOf("colour")&&l.find('[data-property="'+t+'"]').css("background-color","")}),l.on("click",".color-palette .color",function(){var t=$(this).data("color"),e=$(this).closest('[data-type="row"]').find('[data-type="key"]').text().trim();$(this).closest('[data-type="row"]').find(".prop").html(t),s[e]=t,r(),p()}),d(),l.on("click",'[data-type="vote"]',function(){$.post(environment.root+"/post/vote").done(function(t){localStorage.vote=!0,l.find('[data-type="vote"]').replaceWith('<div style="display: inline;">&#10003;</div>').addClass("no-click").css("opacity","0.5")})})}function n(e){var a,n=l.find('[data-type="tab-container"] ul'),i=l.find('[data-type="obj-container"]');a=n.children().last().prev().data("id")+1,isNaN(a)&&(a=0),n.children().last().before('\n			<li data-type="tab" data-id="'+a+'" class="tab" style="opacity: 0.5;">'+e.name+"</li>\n		"),l.find('[data-type="tab"]').filter('[data-id="'+a+'"]').animate({opacity:1},300,"swing"),i.children().last().before('\n			<box data-type="obj" data-id="'+a+'" data-template-id="'+e.id+'" class="tabobj">\n				<div class="template-container">\n					<div class="container">\n						<input type="text" class="template-name" data-type="template-name" placeholder="Template name" value="'+e.name+'" required>\n					</div>\n					<hr>\n					<div style="position: relative;overflow: hidden;">\n						<div data-type="document" data-id="{{i}}" class="template-document" style="opacity: 0.25;padding: 10mm 0;">\n							'+e.body+'\n						</div>\n						<div data-type="template-hud" class="template-hud">\n							<div class="play-container" style="padding-right: 50mm;">\n								<div data-type="previous" class="play-padding">\n									<div class="play-left"></div>\n								</div>\n							</div>\n							<div class="play-container" style="padding-left: 50mm;">\n								<div data-type="next" class="play-padding">\n									<div class="play-right"></div>\n								</div>\n							</div>\n						</div>\n					</div>\n				</div>\n			</box>\n		'),p(),Paperwork.send("tab."+t.name+".activate",a)}function i(t){function e(){$.post(m.update,{id:n,direction:t}).done(function(t){t=JSON.parse(t),l.find(".tabopen .document-owner").css("width","auto"),l.find('.tabopen [data-type="document"]').html(t.body).css({opacity:0,marginLeft:a+"px",overFlow:"auto"}).animate({opacity:1,marginLeft:0},100,"swing"),p()})}var a,n=l.find(".tabopen").data("template-id");a="previous"==t?"-10":"10",l.find(".tabopen .document-owner").css("width",l.find(".tabopen .document-owner").outerWidth()),l.find('.tabopen [data-type="document"]').animate({opacity:0,marginLeft:-1*a+"px"},100,"swing",e).css("overflow","hidden")}function o(){$.get(m.get).done(function(t){t=JSON.parse(t),s=t,p()})}function d(){l.on("keyup",'[data-type="properties"] .prop',function(){var t,e=$(this).closest('[data-type="row"]').find('[data-type="key"]').text().trim();t=f.toText($(this)),s[e]=t.html().trim(),r(),p()}),l.on("blur",'[data-type="properties"] .prop',function(){var t=$(this).closest('[data-type="row"]').find('[data-type="key"]').text().trim();$(this).html(s[t]),p()})}function p(){Paperwork.send("document.template.reload",s)}function r(){clearTimeout(c),c=setTimeout(function(){$.post(m.putProp,{properties:s})},500)}var c,l=t.element,s={},m={get:environment.root+"/get/template-properties",update:environment.root+"/post/update-template",post:environment.root+"/post/template","delete":environment.root+"/delete/template",putProp:environment.root+"/put/properties",putTemplate:environment.root+"/put/template"},f=t.require("parse");t.use("tab"),t.use("document");var u=["#1abc9c","#16a085","#2ecc71","#27ae60","#3498db","#2980b9","#9b59b6","#8e44ad","#34495e","#2c3e50","#f1c40f","#f39c12","#e67e22","#d35400","#e74c3c","#c0392b","#ecf0f1","#bdc3c7","#95a5a6","#7f8c8d","white","black"];e(),a(),o()});