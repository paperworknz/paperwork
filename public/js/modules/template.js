"use strict";Core.addModule("template",function(t){function e(){var t={select:d.find(".template-icon"),"delete":d.find(".template-delete"),create:d.find('[data-type="template-create"]'),update:d.find('[data-type="properties-update"]')};for(var e in t)t[e].off();d.find('[data-type="template-name"]').on("keyup",function(){var t=$(this).closest('[data-type="obj"]').data("id");p(),"+"!=t&&d.find('[data-type="tab-container"] [data-id="'+t+'"]').html($(this).val())}),d.find('[data-type="template-name"]').on("blur",function(){var t=$(this).closest("[data-template-id]").data("template-id"),e=$(this).val().trim();$.post(l.putTemplate,{id:t,name:e}).done(function(t){p(),Paperwork.send("notification")})}),t.create.on("click",function(){var t=d.find('.new-template [data-type="new-template-name"]').val().trim();$.post(l.post,{name:t}).done(function(t){var e=JSON.parse(t);d.find('.new-template [data-type="new-template-name"]').val(""),a({id:e.id,name:e.name,body:e.body}),Paperwork.ready(d.find('[data-type="template-create"]'),"CREATE")})}),Paperwork.validate(d.find(".new-template"),t.create,Paperwork.random(6),{allowDuplicates:!0}),d.on("click",'[data-type="previous"]',function(){n("previous")}),d.on("click",'[data-type="next"]',function(){n("next")}),d.on("mouseover",'[data-type="row"]',function(){var t=$(this).find('[data-type="key"]').text().trim();d.find('[data-property="'+t+'"]').css("background-color","#D6EDFF")}),d.on("mouseout",'[data-type="row"]',function(){var t=$(this).find('[data-type="key"]').text().trim();d.find('[data-property="'+t+'"]').css("background-color","")}),o()}function a(e){var a,n=d.find('[data-type="tab-container"] ul'),i=d.find('[data-type="obj-container"]');a=n.children().last().prev().data("id")+1,n.children().last().before('\n			<li data-type="tab" data-id="'+a+'" class="tab" style="opacity: 0.5;">'+e.name+"</li>\n		"),d.find('[data-type="tab"]').filter('[data-id="'+a+'"]').animate({opacity:1},300,"swing"),i.children().last().before('\n			<box data-type="obj" data-id="'+a+'" data-template-id="'+e.id+'" class="tabobj">\n				<div class="template-container">\n					<div class="container">\n						<input type="text" class="template-name" data-type="template-name" placeholder="Template name" value="'+e.name+'" required>\n					</div>\n					<hr>\n					<div data-type="template-document" class="template-document">\n						'+e.body+"\n					</div>\n				</div>\n			</box>\n		"),p(),Paperwork.send("tab."+t.name+".activate",a)}function n(t){function e(){$.post(l.update,{id:n,direction:t}).done(function(t){t=JSON.parse(t),d.find('.tabopen [data-type="template-document"]').html(t.body).css({opacity:0,marginLeft:a+"px"}).animate({opacity:1,marginLeft:0},100,"swing"),p()})}var a,n=d.find(".tabopen").data("template-id");a="previous"==t?"-10":"10",d.find('.tabopen [data-type="template-document"]').animate({opacity:0,marginLeft:-1*a+"px"},100,"swing",e)}function i(){$.get(l.get).done(function(t){t=JSON.parse(t),r=t,p()})}function o(){d.on("keyup",'[data-type="properties"] input',function(){r[$(this).closest('[data-type="row"]').find('[data-type="key"]').text().trim()]=$(this).val(),p()}),d.on("blur",'[data-type="properties"] input',function(){$.post(l.putProp,{properties:r}).done(function(t){Paperwork.send("notification")})})}function p(){d.find('[data-type="template-document"]').each(function(){$(this).find('[data-property="name"]').html($(this).closest("[data-template-id]").find('[data-type="template-name"]').val())});for(var t in r){var e=r[t],a=d.find('[data-type="template-document"] [data-property="'+t+'"]');a.html(e),d.find('[data-type="properties"] [data-type="'+t+'"]').val(e)}}var d=t.element,r={},l={get:environment.root+"/get/template-properties",update:environment.root+"/post/update-template",post:environment.root+"/post/template","delete":environment.root+"/delete/template",putProp:environment.root+"/put/properties",putTemplate:environment.root+"/put/template"};t.use("tab"),e(),i()});