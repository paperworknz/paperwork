"use strict";Core.addModule("template",function(t){function e(){var e={create:l.find(".template-create"),select:l.find(".template-icon"),publish:l.find(".template-publish"),"delete":l.find(".template-delete")};for(var s in e)e[s].off();i=t.use("tab"),l.find("input.template-name").on("keyup",function(){var t=$(this).closest('[data-type="obj"]').data("id");"+"!=t&&l.find('[data-type="tab-container"] [data-id="'+t+'"]').html($(this).val())}),e.publish.on("click",function(){var t=$(this).closest("[data-template-id]").data("template-id"),e=$(this).closest("[data-template-id]").find("input.template-name").val(),a=$(this).closest("[data-template-id]").find(".template-form").html(),n=$(this),i=$(this).html();$.post(o.put,{id:t,name:e,content:a}).done(function(t){t=JSON.parse(t),Paperwork.ready(n,i),Paperwork.send("notification")})}),e["delete"].on("click",function(){var a=$(this).closest("[data-template-id]").data("template-id"),i=l.find("[data-template-id="+a+"]").data("id"),s=e["delete"].html();swal({title:"Are you sure you want to delete this template?",text:"You can restore this from the trash tab in settings",showCancelButton:!0,closeOnConfirm:!0},function(l){return l?void $.post(o["delete"],{id:a}).done(function(e){n(i),delete d[a],Paperwork.send("tab."+t.name+".activate","last"),Paperwork.send("notification")}):void Paperwork.ready(e["delete"],s)})}),e.select.on("click",function(){var t=$(this).find("img");t.hasClass("img-active")?(t.removeClass("img-active"),l.find(".template-shell").val("")):(t.addClass("img-active"),l.find(".template-shell").val("1")),l.find(".template-shell").blur()}),e.create.on("click",function(){var e=l.find('[data-type="obj"]').filter('[data-id="+"]'),n=e.find(".template-name").val(),i=e.find(".img-active").data("name");$.post(o.post,{theme:i,name:n}).done(function(n){n=JSON.parse(n),e.find(".template-name").val(""),e.find(".img-active").removeClass("img-active"),l.find(".template-shell").val(""),a({id:n.id,name:n.name,content:n.content}),Paperwork.ready(l.find(".template-create"),"CREATE"),Paperwork.send("tab."+t.name+".activate","last")})}),Paperwork.validate(l.find(".new-template"),e.create,Paperwork.random(6),{allowDuplicates:!0})}function a(e){var a,n=l.find('[data-type="tab-container"] ul'),i=l.find('[data-type="obj-container"]');a=n.children().last().prev().data("id")+1,n.children().last().before('\n			<li data-type="tab" data-id="'+a+'" class="tab">'+e.name+"</li>\n		"),i.children().last().before('\n			<box data-type="obj" data-id="'+a+'" data-template-id="'+e.id+'" class="tabobj">\n				<div class="container wrap">\n					<div class="left" style="width: 33%;">\n						<input type="text" class="template-name" placeholder="'+e.name+'" value="'+e.name+'">\n					</div>\n				</div>\n				<hr>\n				<div class="container template-form">\n					'+e.content+'\n				</div>\n				<hr>\n				<div class="container wrap">\n					<ul class="list-inline left">\n						<li>\n							<button class="button template-publish">PUBLISH</button>\n						</li>\n					</ul>\n					<ul class="list-inline right">\n						<li>\n							<button class="button delete template-delete">DELETE</button>\n						</li>\n					</ul>\n				</div>\n			</box>\n		'),Paperwork.send("tab."+t.name+".activate",a)}function n(t){l.find('[data-id="'+t+'"]').remove()}var i,l=t.element,d={},o={post:environment.root+"/post/template",put:environment.root+"/put/template","delete":environment.root+"/delete/template"};e()});