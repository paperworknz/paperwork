"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};Core.addModule("job",function(t){function n(){Paperwork.on("document.new",function(t){return"object"!==("undefined"==typeof t?"undefined":_typeof(t))||null===t?console.warn("New document request not an object"):void m(t)})}function e(){Paperwork.wait(b.find(".pdf-load")),$.get(f.getPDFList).done(function(t){if("0"==t)return void b.find(".pdf-load").closest("tr").remove();t=JSON.parse(t),b.find(".pdf-load").remove(),b.find(".pdf-title").html("Paper");for(var n in t){var e=t[n];b.find(".pdf-list").append('\n					<div style="height:24px;line-height:24px">\n						<a target="_blank" href="'+environment.root+"/get/pdf/"+job.job_number+"/"+e+'">'+e+"</a>\n					</div>\n				")}})}function o(){b.on("click",".note-wrap",function(){b.find(".notepad").focus()}),b.on("blur",".notepad",function(){$.post(f.put,{notes:$(this).html(),id:job.job_id}).done(function(t){Paperwork.send("notification")})})}function i(){b.on("change",".status",function(){void 0!=$(this).val()&&$.post(f.put,{id:job.job_id,status:$(this).val()}).done(function(t){return"0"==t?Paperwork.send("notification","Failed to change"):void Paperwork.send("notification","Saved")})})}function a(){b.on("change",".job-name",function(){""!=$(".job-name").val()&&$.post(f.put,{name:$(".job-name").val().trim(),id:job.job_id}).done(function(t){Paperwork.send("notification","Saved")})})}function d(){b.on("click",'[data-type="job-delete-button"]',function(){var t={name:$(this).text().trim(),element:$(this)};swal({title:"Are you sure you want to delete this job?",text:"Deleting this job will delete ALL quotes and invoices attached",showCancelButton:!0,closeOnConfirm:!0},function(n){return n?void b.find("[job-del-form]").submit():Paperwork.ready(t.element,t.name)})})}function r(){b.on("click",'[data-type="copy-button"]',function(){var n=b.find('.tabopen [data-type="document"]').data("id"),e=p.documents(n);t.load("document-copy",{job_id:job.job_id,job_number:job.job_number,document_id:n,documents:e})}),b.on("click",'[data-type="margin-button"]',function(){var n=b.find('.tabopen [data-type="document"]').data("id"),e=p.documents(n);t.load("document-margin",{document_id:n,documents:e})})}function u(){b.on("click",'[data-type="document-delete-button"]',function(){var n=b.find('.tabopen [data-type="document"]').data("id"),e={name:$(this).text().trim(),element:$(this)};swal({title:"Are you sure you want to delete this document?",text:"You can undo this later",showCancelButton:!0,closeOnConfirm:!0},function(o){return o?void $.post(f["delete"],{id:n}).done(function(n){var e=b.find('[data-type="tab-container"] .active').data("id");Paperwork.send("tab."+t.name+".remove",e)}):Paperwork.ready(e.element,e.name)})})}function c(){b.on("click",'[data-type="new-document"]',function(){var t=$(this).data("template-id"),n=job.client_id,e=job.job_id;({name:$(this).text().trim(),element:$(this)});m({job_id:e,client_id:n,template_id:t})})}function m(t){$.post(f.post,{job_id:t.job_id,template_id:t.template_id,document:t.document}).done(function(n){return n=JSON.parse(n),t.job_number&&t.job_number!=job.job_number?Paperwork["goto"](environment.root+"/job/"+t.job_number+"?activate=last"):void l({name:t.name||n.name,body:t.body||n.body,document:n.document})})}function l(n){var e,o=b.find('[data-type="tab-container"] ul'),i=b.find('[data-type="obj-container"]');e=o.children().last().prev().data("id")+1,o.children().last().before('\n			<li data-type="tab" data-id="'+e+'" class="tab" style="opacity: 0.5;">\n				'+n.name+"\n			</li>\n		"),b.find('[data-type="tab"]').filter('[data-id="'+e+'"]').animate({opacity:1},300,"swing"),i.children().last().before('\n			<part data-type="obj" data-id="'+e+'" class="tabobj">\n				'+n.body+"\n			</part>\n		"),Paperwork.send("tab."+t.name+".activate",e),Paperwork.send("document.build",n.document)}var b=t.element,f={post:environment.root+"/post/document","delete":environment.root+"/delete/document",put:environment.root+"/put/job",getPDFList:environment.root+"/get/pdf-json/"+job.job_number},p=t.use("document");t.use("tab"),e(),o(),i(),a(),d(),r(),u(),c(),n()});