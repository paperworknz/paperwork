"use strict";function _defineProperty(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};Core.addModule("job",function(t){function e(){Paperwork.on("document.new",function(t){return"object"!==("undefined"==typeof t?"undefined":_typeof(t))||null===t?console.warn("New document request not an object"):void b(t)})}function o(){s.on("click",'[data-type="save-button"]',function(){var t=s.find('.tabopen [data-type="document"]').data("id");Paperwork.send("document.job.save",t)})}function n(){Paperwork.wait(s.find(".pdf-load")),$.get(y.getPDFList).done(function(t){if("0"==t)return void s.find(".pdf-load").closest("tr").remove();t=JSON.parse(t),s.find(".pdf-load").remove(),s.find(".pdf-title").html("Paper");for(var e in t){var o=t[e];s.find(".pdf-list").append('\n					<div style="height:24px;line-height:24px">\n						<a target="_blank" href="'+environment.root+"/get/pdf/"+job.job_number+"/"+o+'" onclick="event.stopPropagation();">'+o+"</a>\n					</div>\n				")}})}function i(){s.on("click",".note-wrap",function(){s.find(".notepad").focus()}),s.on("blur",".notepad",function(){$.post(y.put,{notes:$(this).html(),id:job.job_id}).done(function(t){Paperwork.send("notification")})})}function a(){s.on("change",".status",function(){void 0!=$(this).val()&&$.post(y.put,{id:job.job_id,status:$(this).val()}).done(function(t){return"0"==t?Paperwork.send("notification","Failed to change"):void Paperwork.send("notification","Saved")})})}function d(){s.on("change",".job-name",function(){""!=$(".job-name").val()&&$.post(y.put,{name:$(".job-name").val().trim(),id:job.job_id}).done(function(t){Paperwork.send("notification","Saved")})})}function r(){s.on("click",'[data-type="job-delete-button"]',function(){var t={name:$(this).text().trim(),element:$(this)};swal({title:"Are you sure you want to delete this job?",text:"Deleting this job will delete ALL quotes and invoices attached",showCancelButton:!0,closeOnConfirm:!0},function(e){return e?void s.find("[job-del-form]").submit():Paperwork.ready(t.element,t.name)})})}function c(){s.on("click",'[data-type="copy-button"]',function(){var e=s.find('.tabopen [data-type="document"]').data("id"),o=h.documents(e);t.load("document-copy",{job_id:job.job_id,job_number:job.job_number,document_id:e,documents:o})}),s.on("click",'[data-type="margin-button"]',function(){var e=s.find('.tabopen [data-type="document"]').data("id"),o=h.documents(e);t.load("document-margin",{document_id:e,documents:o})}),s.on("click",'[data-type="pdf-button"]',function(){var t=l(),e=job.job_number;f.post({directory:e,document_html:t.document_html,document_name:t.document_name},function(t){return t?(Paperwork.ready(s.find('[data-type="pdf-button"]'),"PDF"),void Paperwork["goto"](t.location,!1)):swal({title:"Sorry, something went wrong",text:"Please try again!",type:"error",closeOnConfirm:!1},function(){Paperwork["goto"]("reload")})})}),s.on("click",'[data-type="email-button"]',function(){var e=(s.find('.tabopen [data-type="document"]').data("id"),job.job_id,job.job_number),o=l();Paperwork.wait(s.find('.tabopen [data-type="pdf-button"]')),f.post({directory:e,document_html:o.document_html,document_name:o.document_name},function(e){return Paperwork.ready(s.find('.tabopen [data-type="pdf-button"]'),"PDF"),e?void t.load("email",{address:job.client_email,attachments:_defineProperty({},o.document_name,e.location)}):swal({title:"Sorry, something went wrong",text:"We couldn't generate a PDF. Please try again!",type:"error",closeOnConfirm:!1},function(){Paperwork["goto"]("reload")})})})}function l(){var t=s.find('.tabopen [data-type="document"]').html(),e=(s.find('.tabopen [data-type="document"] [data-template]').data("template"),s.find('[data-type="tab"].active').data("id")),o=s.find('[data-type="tab"].active').html().toLowerCase(),n=job.job_number+"_"+e+"-"+o;return t='\n		<!DOCTYPE html>\n		<html lang=\'en\'>\n			<head>\n				<meta charset="utf-8">\n				<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">\n				<meta name="format-detection" content="telephone=no">\n				<style>\n				/*! normalize.css v4.1.1 | MIT License | github.com/necolas/normalize.css */progress,sub,sup{vertical-align:baseline}button,hr,input{overflow:visible}[type=checkbox],[type=radio],legend{padding:0;box-sizing:border-box}doc-body *,legend{box-sizing:border-box}doc-body,doc-body doc-section{display:-webkit-box;display:-ms-flexbox}article,aside,details,doc-body *,doc-body [data-type=inventory-input],doc-body [data-type=inventory-content],figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}button,input,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:ButtonText dotted 1px}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{color:inherit;display:table;max-width:100%;white-space:normal}textarea{overflow:auto}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}doc-body{width:210mm;max-width:210mm;min-width:210mm;color:#333;background-color:#fff;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;line-height:1.42857143;font-size:13px!important;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}doc-body doc-section{display:flex;cursor:default}doc-body doc-section>*{-webkit-box-flex:1;-ms-flex:1;flex:1}doc-body .inventory-item_price,doc-body .inventory-item_qty,doc-body [contenteditable]{cursor:text;outline:0}doc-body .inventory-item_price:hover,doc-body .inventory-item_qty:hover,doc-body [contenteditable]:hover{background-color:#D6EDFF}doc-body [data-type=inventory-content]{display:table;border-bottom:1px solid #000}doc-body .inventory-item{display:table-row;page-break-inside:avoid!important}doc-body .inventory-item>doc-part{display:table-cell;vertical-align:top}doc-body .inventory-item:hover .inventory-item_name .remove-btn{opacity:.25}doc-body .inventory-item .inventory-item_name{position:relative;width:100%}doc-body .inventory-item .inventory-item_name .remove-btn{opacity:0;position:absolute;top:0;right:0}doc-body .inventory-item .inventory-item_name .remove-btn:hover{opacity:1}doc-body .twitter-typeahead{display:inline-block;border-right:1px solid #000;border-bottom:1px dashed #999;border-left:1px solid #000;width:100%}doc-body .twitter-typeahead .typeahead{padding:4px;width:100%;outline:0;border:1px solid #fff}doc-body .twitter-typeahead .tt-highlight,doc-body .twitter-typeahead .tt-input{display:inline-block}doc-body .twitter-typeahead .tt-highlight:hover,doc-body .twitter-typeahead .tt-input:hover{background-color:#D6EDFF!important}doc-body .twitter-typeahead .tt-highlight:active,doc-body .twitter-typeahead .tt-highlight:focus,doc-body .twitter-typeahead .tt-input:active,doc-body .twitter-typeahead .tt-input:focus{background-color:transparent!important}doc-body .twitter-typeahead .ta{z-index:1;width:100%;border-top:1px solid #333;border-left:1px solid #333;border-right:1px solid #333}doc-body .twitter-typeahead .tt-menu{z-index:1!important;background-color:#fff;border:1px solid #eee;box-shadow:rgba(0,0,0,.329412) 0 0 5px;cursor:default}\n				</style>\n				<style>\n				[data-template=mike] .inventory-item .inventory-item_name{border-left:1px solid #000}[data-template=mike] .inventory-item .inventory-item_name doc-text{padding:3px 6px}[data-template=mike] .inventory-item .inventory-item_price,[data-template=mike] .inventory-item .inventory-item_qty,[data-template=mike] .inventory-item .inventory-item_total{border-left:1px solid #000;min-width:95px;text-align:center;padding:3px 6px;height:100%}[data-template=mike] .inventory-item .inventory-item_total{border-right:1px solid #000}\n				</style>\n				<style>\n					doc-body {\n						letter-spacing: -1px;\n					}\n					[data-type="inventory-input"] {\n						display: none!important;\n					}\n				</style>\n			</head>\n			<body>\n				'+t+"\n			</body>\n		</html>\n		",{document_html:t,document_name:n}}function p(){s.on("click",'[data-type="document-delete-button"]',function(){var e=s.find('.tabopen [data-type="document"]').data("id"),o={name:$(this).text().trim(),element:$(this)};swal({title:"Are you sure you want to delete this document?",text:"You can undo this later",showCancelButton:!0,closeOnConfirm:!0},function(n){return n?void $.post(y["delete"],{id:e}).done(function(e){var o=s.find('[data-type="tab-container"] .active').data("id");Paperwork.send("tab."+t.name+".remove",o)}):Paperwork.ready(o.element,o.name)})})}function m(){s.on("click",'[data-type="new-document"]',function(){var t=$(this).data("template-id"),e=job.client_id,o=job.job_id;({name:$(this).text().trim(),element:$(this)});b({job_id:o,client_id:e,template_id:t})})}function b(t){$.post(y.post,{job_id:t.job_id,template_id:t.template_id,document:t.document}).done(function(e){return e=JSON.parse(e),t.job_number&&t.job_number!=job.job_number?Paperwork["goto"](environment.root+"/job/"+t.job_number+"?activate=last"):void u({name:t.name||e.name,body:t.body||e.body,document:e.document})})}function u(e){var o,n=s.find('[data-type="tab-container"] ul'),i=s.find('[data-type="obj-container"]');o=n.children().last().prev().data("id")+1,n.children().last().before('\n			<li data-type="tab" data-id="'+o+'" class="tab" style="opacity: 0.5;">\n				'+e.name+"\n			</li>\n		"),s.find('[data-type="tab"]').filter('[data-id="'+o+'"]').animate({opacity:1},300,"swing"),i.children().last().before('\n			<part data-type="obj" data-id="'+o+'" class="tabobj">\n				'+e.body+"\n			</part>\n		"),Paperwork.send("tab."+t.name+".activate",o),Paperwork.send("document.build",e.document)}var s=t.element,y={post:environment.root+"/post/document","delete":environment.root+"/delete/document",put:environment.root+"/put/job",getPDFList:environment.root+"/get/pdf-json/"+job.job_number},f=t.require("pdf"),h=t.use("document");t.use("tab");n(),i(),a(),d(),r(),c(),o(),p(),m(),e()});