"use strict";Core.addModule("email",function(t){function a(){Paperwork.validate(c,c.find('[data-type="send-button"]'),"email",{allowDuplicates:!0}),c.on("click",".attachment-remove",function(){var a=$(this).closest('[data-type="attachment"]').data("name");delete t.data.attachments[a],$(this).closest('[data-type="attachment"]').hide()}),c.on("click",'[data-type="send-button"]',function(){var a=c.find('[data-type="address"]').val().trim(),e=c.find('[data-type="cc"]').val().trim(),s=c.find('[data-type="bcc"]').val().trim(),d=c.find('[data-type="subject"]').val().trim(),o=c.find('[data-type="password"]').val(),r=c.find('[data-type="body"]').html(),i=t.data.attachments;n({address:a,cc:e,bcc:s,subject:d,password:o,body:r,attachments:i})}),c.on("click",'[data-type="cancel-button"]',o)}function e(t){var a=t.address,e=void 0===a?"":a,n=t.subject,s=void 0===n?"":n,d=t.password,o=void 0===d?"":d,r=t.attachments,i=void 0===r?{}:r;c.find('[data-type="address"]').val(e),c.find('[data-type="subject"]').val(s),c.find('[data-type="password"]').val(o);for(var l in i)c.find('[data-type="attachments"]').append('\n				<part class="attachment wrap" data-type="attachment" data-name="'+l+'">\n					<part>\n						'+l+'.pdf\n					</part>\n					<part class="attachment-remove remove-btn"></part>\n				</part>\n			')}function n(t){return t.subject?(c.find(".parent").addClass("noclick noselect").css("opacity",.5),Paperwork.wait(c.find('[data-type="send-button"]')),void $.post(r.email,{address:t.address,cc:t.cc,bcc:t.bcc,subject:t.subject,password:t.password,body:t.body,attachments:t.attachments}).done(function(t){return t=JSON.parse(t),"error"==t.type?d({title:"Mail Not Sent",text:t.message}):swal({type:"success",title:t.message},function(t){return o()})})):s({type:"subject",title:"No Subject",text:"Are you sure you want to send this without a subject?",message:t,last:!0})}function s(t){var a=t.type,e=t.title,s=void 0===e?"Warning":e,d=t.text,o=void 0===d?"":d,c=t.message,r=t.last,i=void 0===r?!1:r;return swal({type:"warning",title:s,text:o,showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:i},function(){return c[a]=!0,n(c)})}function d(t){var a=t.title,e=void 0===a?"Mail Not Sent":a,n=t.text,s=void 0===n?"There was a problem sending your mail.":n;return swal({type:"error",title:e,text:s,closeOnConfirm:!0},function(){c.find(".parent").removeClass("noclick noselect").css("opacity",1),Paperwork.ready(c.find('[data-type="send-button"]'),"SEND")})}function o(){t.stop()}var c=t.element,r={email:environment.root+"/post/email"};e({address:t.data.address,subject:t.data.subject,password:localStorage.ep,attachments:t.data.attachments}),a()});