"use strict";Core.addModule("email",function(t){function e(){Paperwork.validate(i,i.find('[data-type="send-button"]'),"email",{allowDuplicates:!0}),i.on("click",'[data-type="send-button"]',function(){var t=i.find('[data-type="address"]').val().trim(),e=i.find('[data-type="subject"]').val().trim(),a=i.find('[data-type="password"]').val(),n=i.find('[data-type="body"]').html();s({address:t,subject:e,password:a,body:n})}),i.on("click",'[data-type="cancel-button"]',d)}function a(t){var e=t.address,a=void 0===e?"":e,s=t.subject,n=void 0===s?"":s,o=t.password,d=void 0===o?"":o;i.find('[data-type="address"]').val(a),i.find('[data-type="subject"]').val(n),i.find('[data-type="password"]').val(d)}function s(t){return t.subject?(i.find(".parent").addClass("noclick noselect").css("opacity",.5),Paperwork.wait(i.find('[data-type="send-button"]')),void $.post(r.email,{address:t.address,subject:t.subject,password:t.password,body:t.body}).done(function(t){return t=JSON.parse(t),"error"==t.type?o({title:"Mail Not Sent",text:"Response: "+t.message}):swal({type:"success",title:t.message},function(t){return d()})})):n({type:"subject",title:"No Subject",text:"Are you sure you want to send this without a subject?",message:t,last:!0})}function n(t){var e=t.type,a=t.title,n=void 0===a?"Warning":a,o=t.text,d=void 0===o?"":o,i=t.message,r=t.last,c=void 0===r?!1:r;return swal({type:"warning",title:n,text:d,showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:c},function(){return i[e]=!0,s(i)})}function o(t){var e=t.title,a=void 0===e?"Mail Not Sent":e,s=t.text,n=void 0===s?"There was a problem sending your mail.":s;return swal({type:"error",title:a,text:n,closeOnConfirm:!0},function(){i.find(".parent").removeClass("noclick noselect").css("opacity",1),Paperwork.ready(i.find('[data-type="send-button"]'),"SEND")})}function d(){t.stop()}var i=t.element,r={email:environment.root+"/post/email"};a({address:t.data.address,subject:t.data.subject,password:localStorage.ep}),e()});