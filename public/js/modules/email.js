"use strict";Core.addModule("email",function(t){function a(){Paperwork.validate(c,c.find('[data-type="send-button"]'),"email",{allowDuplicates:!0}),c.on("click",".attachment-remove",function(){var a=$(this).closest('[data-type="attachment"]').data("name"),e=$(this);swal({title:"Are you sure you want to remove this attachment?",text:"This email will be sent without "+a,showCancelButton:!0,closeOnConfirm:!0},function(n){n&&(delete t.data.attachments[a],e.closest('[data-type="attachment"]').hide())})}),c.on("click",'[data-type="send-button"]',function(){var a=c.find('[data-type="address"]').val().trim(),e=c.find('[data-type="cc"]').val().trim(),s=c.find('[data-type="bcc"]').val().trim(),o=c.find('[data-type="subject"]').val().trim(),d=c.find('[data-type="password"]').val(),i=c.find('[data-type="body"]').html(),r=t.data.attachments;n({address:a,cc:e,bcc:s,subject:o,password:d,body:i,attachments:r})}),c.on("click",'[data-type="cancel-button"]',d)}function e(t){var a=t.address,e=void 0===a?"":a,n=t.subject,s=void 0===n?"":n,o=t.password,d=void 0===o?"":o,i=t.attachments,r=void 0===i?{}:i;c.find('[data-type="address"]').val(e),c.find('[data-type="subject"]').val(s),c.find('[data-type="password"]').val(d);for(var l in r)c.find('[data-type="attachments"]').append('\n				<part class="attachment wrap" data-type="attachment" data-name="'+l+'">\n					<part>\n						'+l+'.pdf\n					</part>\n					<part class="attachment-remove remove-btn"></part>\n				</part>\n			')}function n(t){return t.subject?(c.find(".parent").addClass("noclick noselect").css("opacity",.5),Paperwork.wait(c.find('[data-type="send-button"]')),void $.post(i.email,{address:t.address,cc:t.cc,bcc:t.bcc,subject:t.subject,password:t.password,body:t.body,attachments:t.attachments}).done(function(t){return t=JSON.parse(t),"error"==t.type?o({title:"Mail Not Sent",text:t.message}):swal({type:"success",title:t.message},function(t){return d()})})):s({type:"subject",title:"No Subject",text:"Are you sure you want to send this without a subject?",message:t,last:!0})}function s(t){var a=t.type,e=t.title,s=void 0===e?"Warning":e,o=t.text,d=void 0===o?"":o,c=t.message,i=t.last,r=void 0===i?!1:i;return swal({type:"warning",title:s,text:d,showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:r},function(){return c[a]=!0,n(c)})}function o(t){var a=t.title,e=void 0===a?"Mail Not Sent":a,n=t.text,s=void 0===n?"There was a problem sending your mail.":n;return swal({type:"error",title:e,text:s,closeOnConfirm:!0},function(){c.find(".parent").removeClass("noclick noselect").css("opacity",1),Paperwork.ready(c.find('[data-type="send-button"]'),"SEND")})}function d(){t.stop()}var c=t.element,i={email:environment.root+"/post/email"};e({address:t.data.address,subject:t.data.subject,password:localStorage.ep,attachments:t.data.attachments}),a()});